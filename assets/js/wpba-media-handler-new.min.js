/**
* Updates Sort Order
*/function updateSortOrder(e){var t=jQuery,n=e.find("li"),r=[],i={action:"wpba_update_sort_order"},s=t(".wpba-saving");n.each(function(){var e=t(this);r.push(e.data("id"))});i.attids=r;s.removeClass("hide");t.post(ajaxurl,i,function(e){s.addClass("hide");return!1})}function unattachAttachment(e){var t=jQuery,n=t("#wpba_image_sortable"),r=e.parent("li").parent("ul"),i=r.data("id"),s={action:"wpba_unattach_",attachmentid:i},o=t(".wpba-saving");o.removeClass("hide");t.post(ajaxurl,s,function(e){var i=t.parseJSON(e);if(i){r.parent("li").remove();updateSortOrder(n)}})}function deleteAttachment(e){var t=jQuery,n=confirm("Are you sure you want to permanently delete this attachment? This will permanently remove the attachment from the media gallery!!"),r=t(".wpba-saving"),i=t("#wpba_image_sortable");if(n){var s=e.parent("li").parent("ul"),o=s.data("id"),u={action:"wpba_delete_attachment",attachmentid:o};r.removeClass("hide");t.post(ajaxurl,u,function(e){var n=t.parseJSON(e);if(n){s.parent("li").remove();updateSortOrder(i)}})}}jQuery(function(e){e(window).load(function(){var t=e("#wpba_image_sortable"),n=e(".wpba-unattach"),r=e(".wpba-delete"),i=e(".wpba-saving");t.sortable();t.disableSelection();t.on("sortupdate",function(e,n){updateSortOrder(t)});n.on("click",function(t){unattachAttachment(e(this));t.preventDefault();return!1});e(".wpba-unattach-library").on("click",function(t){var n=e(this),r=n.data("id"),i={action:"wpba_unattach_",attachmentid:r};e.post(ajaxurl,i,function(t){var n=e.parseJSON(t);if(n){e("#post-"+r+" .reattach").remove();e("#post-"+r+" .unattach").remove();e("#post-"+r+" .view").empty().append('<a href="http://localhost/~mothership/plugin-dev/?attachment_id='+r+'" title="View “Hello world!”" rel="permalink">View</a>');e("#post-"+r+" .column-parent").empty().append("(Unattached)<br><a class=\"hide-if-no-js\" onclick=\"findPosts.open( 'media[]','"+r+"'"+' ); return false;" href="#the-list">Attach</a>')}});t.preventDefault();return!1});if(e("#wpba_edit_screen").length>0){var s=e(".wpba-edit"),o=e("#wpba_edit_screen"),u=o.find("iframe"),a;s.on("click",function(t){var n=e(this);u.attr("src",n.attr("href"));u.load(function(){css="#adminmenuwrap,#adminmenuback,#wpadminbar,#screen-meta-links,#wpfooter,.add-new-h2 { display: none; }#wpcontent { width: 96%; margin: 0 2%; }";u.contents().find("head").append(e("<style type='text/css'>"+css+"</style>"));a=u.contents().find("#post_ID").val();u.contents().find("#publish").on("click",function(){u.hide();u.load(function(){u.contents().find("head").append(e("<style type='text/css'>"+css+"</style>"));u.show()})});o.show()});t.preventDefault();return!1});e("#wpba_edit_screen_close").on("click",function(t){var n=e(this),r="?v="+Math.round(Math.random()*1e16);o.hide();t.preventDefault();return!1})}r.on("click",function(t){deleteAttachment(e(this));t.preventDefault();return!1})})}(jQuery));jQuery(function(e){e(window).load(function(){var t,n=e(".wpba-saving");e("#wpba_attachments_button, #wpba_form_attachments_button").on("click",function(r){r.preventDefault();var i=e(this);if(t){t.open();return}t=wp.media.frames.file_frame=wp.media({title:e(this).data("uploader_title"),button:{text:e(this).data("uploader_button_text")},multiple:!0});t.on("select",function(){var r=t.state().get("selection").toJSON(),i={attachments:r,action:"wpba_add_attachment",parentid:e(".wpba").data("postid")};n.removeClass("hide");e.post(ajaxurl,i,function(t){resp=e.parseJSON(t);if(resp){e("#wpba_image_sortable").append(resp.image);updateSortOrder(e("#wpba_image_sortable"));e(".wpba-unattach").on("click",function(t){unattachAttachment(e(this));t.preventDefault();return!1})}})});t.open()})})}(jQuery));